# 简易在线商城功能文档

## 项目概述

这是一个基于 Node.js + Vue3 的全栈电商项目，实现了买家购物、商家管理商品、管理员监控系统的基本功能。

## 技术栈

- **前端**: Vue3, Vite, Element Plus, Pinia, Sass
- **后端**: Node.js, Express, PostgreSQL
- **其他**: JWT, Axios, BCrypt

## 用户角色

系统支持三种用户角色：

1. **买家 (Buyer)**: 普通用户，可以浏览商品、搜索、添加到购物车、下单购买
2. **商家 (Seller)**: 可以管理自己的商品，查看销售数据
3. **管理员 (Admin)**: 系统管理员，可以管理用户、商品、订单和查看系统统计

## 功能模块

### 1. 用户管理模块

#### 1.1 用户注册
- 支持用户名和邮箱唯一性验证
- 密码加密存储（使用BCrypt）
- 默认注册为买家角色
- 可指定角色（买家、商家、管理员）

#### 1.2 用户登录
- JWT身份验证
- 登录后返回用户信息和访问令牌
- 会话管理

#### 1.3 用户资料
- 获取当前用户资料
- 管理员可以查看所有用户列表
- 管理员可以删除用户（有权限和关联数据检查）

### 2. 商品管理模块

#### 2.1 商品浏览
- 买家可以查看所有上架商品
- 分页展示商品列表
- 商品搜索功能（按名称和描述）
- 商品详情查看

#### 2.2 商品管理（商家）
- 创建商品（新商品默认为待审核状态）
- 编辑商品信息
- 管理商品库存
- 查看自己的商品列表

#### 2.3 商品审核（管理员）
- 管理员可以批准待上架商品
- 管理员可以下架违规商品
- 管理员可以恢复误下架商品
- 查看所有商品（包括不同状态）

#### 2.4 商品状态
- `active`: 上架状态，买家可见
- `inactive`: 待审核状态，仅管理员可见
- `suspended`: 违规下架状态

### 3. 购物车模块

#### 3.1 购物车操作
- 添加商品到购物车
- 更新购物车中商品数量
- 从购物车移除商品
- 查看购物车内容和总价

#### 3.2 库存管理
- 添加商品时检查库存
- 更新购物车时检查库存
- 确保库存不会超卖

### 4. 订单管理模块

#### 4.1 订单创建
- 从购物车创建订单
- 检查商品库存
- 计算订单总价
- 使用数据库事务确保数据一致性

#### 4.2 订单查看
- 买家可以查看自己的订单列表
- 买家可以查看订单详情
- 订单状态显示

#### 4.3 订单支付
- 买家可以支付待支付订单
- 支付后订单状态更新为已支付

#### 4.4 订单管理（管理员）
- 管理员可以查看所有订单
- 管理员可以更新订单状态（待支付、已支付、已发货、已送达、已取消）

#### 4.5 卖家订单
- 商家可以查看与自己商品相关的订单

#### 4.6 订单状态
- `pending`: 待支付
- `paid`: 已支付
- `shipped`: 已发货
- `delivered`: 已送达
- `cancelled`: 已取消

### 5. 统计与分析模块

#### 5.1 系统统计（管理员）
- 总用户数统计
- 总商品数统计
- 总订单数统计
- 今日收入统计
- 用户角色统计
- 商品状态统计
- 最近订单查看

#### 5.2 商家统计
- 商品总数统计
- 上架商品数统计
- 总订单数统计
- 总销售额统计
- 平均订单金额统计

#### 5.3 热门商品
- 基于销量的热门商品展示

### 6. 前端功能

#### 6.1 页面功能
- 首页（根据用户角色显示不同内容）
- 商品列表页
- 商品详情页
- 购物车页
- 订单列表页
- 订单详情页
- 用户登录/注册页
- 商家中心
- 管理员控制台

#### 6.2 用户体验
- 响应式设计
- 轮播图展示热门商品
- 搜索功能
- 商品分类浏览
- 购物车实时更新

#### 6.3 角色定制化
- 买家：购物功能为主
- 商家：商品管理功能
- 管理员：系统管理功能

## API 接口概览

### 用户相关
- `POST /api/users/register` - 用户注册
- `POST /api/users/login` - 用户登录
- `GET /api/users/profile` - 获取用户资料
- `GET /api/users` - 获取所有用户（管理员）
- `DELETE /api/users/:id` - 删除用户（管理员）

### 商品相关
- `GET /api/products` - 获取商品列表
- `GET /api/products/:id` - 获取商品详情
- `POST /api/products` - 创建商品（商家）
- `PUT /api/products/:id` - 更新商品（商家/管理员）
- `GET /api/products/seller` - 获取商家商品（商家）
- `GET /api/products/search` - 搜索商品
- `POST /api/products/:id/approve` - 批准商品（管理员）
- `POST /api/products/:id/suspend` - 下架商品（管理员）
- `POST /api/products/:id/restore` - 恢复商品（管理员）

### 购物车相关
- `GET /api/cart` - 获取购物车
- `POST /api/cart` - 添加到购物车
- `PUT /api/cart/:productId` - 更新购物车项目
- `DELETE /api/cart/:productId` - 从购物车移除项目

### 订单相关
- `POST /api/orders` - 创建订单
- `GET /api/orders` - 获取用户订单
- `GET /api/orders/:id` - 获取订单详情
- `POST /api/orders/:id/pay` - 支付订单
- `GET /api/orders/admin` - 获取所有订单（管理员）
- `PUT /api/orders/:id/status` - 更新订单状态（管理员）
- `GET /api/orders/seller` - 获取商家相关订单

### 统计相关
- `GET /api/admin/stats` - 系统统计（管理员）
- `GET /api/seller/stats` - 商家统计
- `GET /api/products/popular` - 热门商品

## 安全特性

- JWT身份验证和授权
- 密码加密存储
- 角色权限控制
- 输入验证和错误处理
- SQL注入防护（使用参数化查询）

## 扩展功能

- 商品审核流程
- 多角色权限管理
- 销售统计分析
- 购物车持久化
- 订单状态跟踪